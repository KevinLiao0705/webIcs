
[general]
static=yes
writeprotect=no
clearglobalvars=no
[globals]
CONSOLE=Console/dsp				; Console interface for demo
IAXINFO=guest					; IAXtel username/password
TRUNK=DAHDI/G2					; Trunk interface
TRUNKMSD=1						; MSD digits to strip (usually 1 or 0)
GBV=2
PHONE1=pjsip/2000
PHONE2=pjsip/2001
PHONE3=pjsip/302


[macro-test]
exten=>8921,1,NoOp()
  	same=> n, Playback(demo-thanks)
  	same=> n,SayDigits(${EXTEN})
 	same=> n, Hangup()


;exten => s,1,Dial(${ARG1},20,t)
;exten => s,2,Voicemail(u${MACRO_EXTEN})
;exten => s,3,Hangup
;exten => s,102,Voicemail(b${MACRO_EXTEN})
;exten => s,103,Hangup


[macro-oneline]
exten => s, 1,NoOp()
	same => n, Playback(demo-thanks)
	same => n, Dial(${ARG1},20,t)
	same => n, Hangup()

[macro-sipStandard]
exten => s, 1,NoOp()
	same => n, Playback(demo-thanks)
	same => n, Dial(pjsip/${ARG1},20,t)
	same => n, Hangup()




[macro-page]
; Paging macro:
; Check to see if SIP device is in use and DO NOT PAGE if they are
; ${ARG1} – Device to page
;

exten => s,1,ChanIsAvail(${ARG1}) ; 找出指定通道目前是否可用,j is for dump and s is for ANY call  error call n+101
;exten => s,2,Set(_ALERT_INFO=”RA”) ; This is for the PolyComs
;exten => s,n,Set(PJSIP_HEADER(add,X-MyHeader)=myvalue)
exten => s,n,Set(CALLERID(name)=test)
exten => s,n,NoOp() ; Add others here
exten => s,n,Set(TIMEOUT(absolute)=60)
exten => s,n,Page(${ARG1})
exten => s,n,Hangup
exten => s,102,Hangup

[page] ; Paging context
exten => _X.,1,Macro(page,SIP/${EXTEN})
;The line below goes in the context where you have your extensions:
exten => 7999,1,Set(TIMEOUT(absolute)=60)
exten => 7999,2,Page(Local/202@page&Local/208@page&Local/210@page/n&Local/interal 223@page|)





[stdexten]
exten => _X.,50000(stdexten),NoOp(Start stdexten)
   	same=> n,SayDigits(${EXTEN})
	same => n,Set(LOCAL(ext)=${EXTEN})
	same => n,Set(LOCAL(dev)=${ARG1})
	same => n,Set(LOCAL(cntx)=${ARG2})
	same => n,Set(LOCAL(mbx)=${ext}${IF($[!${ISNULL(${cntx})}]?@${cntx})})
	same => n,Dial(${dev},20)				; Ring the interface, 20 seconds maximum
	same => n,Goto(stdexten-${DIALSTATUS},1)		; Jump based on status (NOANSWER,BUSY,CHANUNAVAIL,CONGESTION,ANSWER)

exten => stdexten-NOANSWER,1,VoiceMail(${mbx},u)	; If unavailable, send to voicemail w/ unavail announce
	same => n,Return()			; If they press #, return to start

exten => stdexten-BUSY,1,VoiceMail(${mbx},b)		; If busy, send to voicemail w/ busy announce
	same => n,Return()			; If they press #, return to start

exten => _stde[x]te[n]-.,1,Goto(stdexten-NOANSWER,1)	; Treat anything else as no answer

exten => a,1,VoiceMailMain(${mbx})			; If they press *, send the user into VoicemailMain
exten => a,n,Return()






[testPrg]
exten=>8900,1,NoOp()
	same=> n, Answer()
	;same=> n,SayDigits(1234)
   	same=> n, Hangup()
   	same => n,Return()

exten => 8901,1,NoOp("1234")
   	same=> n, Hangup()
   	same => n,Return()








[from-pstn]

exten=>_8901,1,Answer()
   	same=> n, Playback(spy-local)
   	same=> n, Hangup()

exten=>_8902,1,Answer()
   	same=> n, Playback(vm-goodbye)
	same=> n, Hangup()


exten=>_891X,1,Answer()
  	same=> n, Playback(demo-thanks)
  	same=> n,SayDigits(${EXTEN})
 	same=> n, Hangup()

exten=>_892X,1,Answer()
   same=> n, Playback(demo-echotest)
   same=> n, Hangup()

;exten=>_8930,1,Macro(test,pjsip/${EXTEN})
exten =>8930,1,Macro(oneline,${PHONE1})

exten =>8931,1,Macro(page,${PHONE1})
exten =>8932,1,Macro(page,${PHONE2})
exten =>8933,1,Macro(page,${PHONE3})



exten =>8940,1,Goto(conf1,1)
exten => conf1,1,NoOp()
	same=> n, Progress()
	same=> n, Wait(1)
	same=> n, ConfBridge(1,myconferenceroom,admin_user)

exten =>8941,1,Goto(conf2,1)
exten => conf2,1,NoOp()
	same=> n, Progress()
	same=> n, Wait(1)
	same=> n, ConfBridge(1,myconferenceroom,default_user)

exten =>8942,1,Goto(conf3,1)
exten => conf3,1,NoOp()
	same=> n, Progress()
	same=> n, Wait(1)
	same=> n, ConfBridge(2,confRoom2,admin_user)



;sip standard call 
exten =>_0700.,1,Macro(sipStandard,${EXTEN:4})



exten=>_3.,1,NoOp()
 	;same=> n, Answer()
 	same=> n, Dial(pjsip/${EXTEN},30)
  	same => n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavailable)
  	;busy process
   	same => n(busy),NoOp()
   	same => n,Verbose(2, Failed Forward ${EXTEN}: Busy now)
   	; same => n,Playback(vm-no)
   	same => n,Hangup()
    ; unavailable process
    same => n(unavailable),NoOp()
    same => n,Verbose(2, Failed Forward ${EXTEN}: No body)
    ; same => n,Playback(vm-nobodyavail)
    same => n,Hangup()

exten=>_2.,1,NoOp()
 	;same=> n, Answer()
 	same=> n, Dial(pjsip/${EXTEN},30)
  	same => n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavailable)
  	;busy process
   	same => n(busy),NoOp()
   	same => n,Verbose(2, Failed Forward ${EXTEN}: Busy now)
   	; same => n,Playback(vm-no)
   	same => n,Hangup()
    ; unavailable process
    same => n(unavailable),NoOp()
    same => n,Verbose(2, Failed Forward ${EXTEN}: No body)
    ; same => n,Playback(vm-nobodyavail)
    same => n,Hangup()


